function renderStock(e){$("#info_holdings").show(),new Chart($("#stock-container"),e).render(),new Table($(".stock_table"),e).render(),stock_first&&$(".sub_sidebar").length&&locationNav(),stock_first=!1}function loadStockData(){$.ajax("../stock_api.php",{dataType:"json",success:function(e){renderStock(e)}})}function loadStockDataByJsonp(){$.getJSON("http://five.cdc.qq.com/stock_api.php",function(e){renderStock(e)})}function getData(){return{status:1,message:"Success.",data:{today:{unit:"100",name:"腾讯控股",code:"00700",current_price:"144.10",yesterday_end:"134.90",today_start:"137.90",trading_volume:"41726996.0",buy_price:"144.10",sell_price:"144.10",time:"2015/08/13 16:00:00",price_difference:"9.20",difference_range:"6.82",highest_price:"145.50",lowest:"137.40",trading_money:"5944717716.52",earning_ratio:"44.78",market_value:"13545.27",year_highest:"171.00",year_lowest:"104.50"},past:[{date:"150702",start_price:"155.000",end_price:"156.500",highest_price:"157.900",lowest_price:"155.000",trading_volume:"22641633"},{date:"150703",start_price:"155.500",end_price:"155.100",highest_price:"156.300",lowest_price:"153.000",trading_volume:"13168577"},{date:"150706",start_price:"153.700",end_price:"146.500",highest_price:"156.000",lowest_price:"140.000",trading_volume:"47555488"},{date:"150707",start_price:"150.000",end_price:"144.700",highest_price:"150.000",lowest_price:"141.500",trading_volume:"27019385"},{date:"150708",start_price:"141.500",end_price:"134.800",highest_price:"141.500",lowest_price:"131.400",trading_volume:"72909743"},{date:"150709",start_price:"137.400",end_price:"146.000",highest_price:"148.300",lowest_price:"137.400",trading_volume:"45436348"},{date:"150710",start_price:"150.000",end_price:"148.900",highest_price:"153.500",lowest_price:"148.300",trading_volume:"36068428"},{date:"150713",start_price:"150.000",end_price:"150.500",highest_price:"151.600",lowest_price:"146.100",trading_volume:"18856475"},{date:"150714",start_price:"152.000",end_price:"151.700",highest_price:"153.300",lowest_price:"150.000",trading_volume:"18064003"},{date:"150715",start_price:"152.700",end_price:"150.000",highest_price:"152.700",lowest_price:"148.100",trading_volume:"15568967"},{date:"150716",start_price:"149.200",end_price:"150.000",highest_price:"150.500",lowest_price:"147.000",trading_volume:"13052255"},{date:"150717",start_price:"151.800",end_price:"153.600",highest_price:"154.300",lowest_price:"150.600",trading_volume:"13958044"},{date:"150720",start_price:"156.000",end_price:"155.500",highest_price:"157.900",lowest_price:"155.100",trading_volume:"16117359"},{date:"150721",start_price:"157.400",end_price:"156.600",highest_price:"157.400",lowest_price:"154.600",trading_volume:"10842641"},{date:"150722",start_price:"156.000",end_price:"154.500",highest_price:"156.000",lowest_price:"153.000",trading_volume:"10289018"},{date:"150723",start_price:"156.500",end_price:"154.500",highest_price:"156.500",lowest_price:"153.400",trading_volume:"11387482"},{date:"150724",start_price:"153.000",end_price:"151.500",highest_price:"153.000",lowest_price:"150.500",trading_volume:"11377581"},{date:"150727",start_price:"150.300",end_price:"145.600",highest_price:"150.800",lowest_price:"145.000",trading_volume:"21263230"},{date:"150728",start_price:"142.600",end_price:"146.500",highest_price:"149.700",lowest_price:"141.100",trading_volume:"25150092"},{date:"150729",start_price:"145.900",end_price:"144.400",highest_price:"146.500",lowest_price:"142.500",trading_volume:"22689923"},{date:"150730",start_price:"145.600",end_price:"142.800",highest_price:"146.500",lowest_price:"142.500",trading_volume:"15637416"},{date:"150731",start_price:"144.100",end_price:"144.700",highest_price:"145.100",lowest_price:"142.500",trading_volume:"14412023"},{date:"150803",start_price:"144.000",end_price:"144.000",highest_price:"144.800",lowest_price:"142.100",trading_volume:"11535567"},{date:"150804",start_price:"142.200",end_price:"143.000",highest_price:"144.000",lowest_price:"141.200",trading_volume:"16430821"},{date:"150805",start_price:"142.000",end_price:"142.400",highest_price:"142.700",lowest_price:"140.500",trading_volume:"11755606"},{date:"150806",start_price:"143.700",end_price:"140.900",highest_price:"143.700",lowest_price:"139.200",trading_volume:"14192153"},{date:"150807",start_price:"139.000",end_price:"142.100",highest_price:"142.400",lowest_price:"139.000",trading_volume:"10787723"},{date:"150810",start_price:"140.000",end_price:"142.800",highest_price:"143.200",lowest_price:"138.600",trading_volume:"11273204"},{date:"150811",start_price:"142.800",end_price:"140.800",highest_price:"145.900",lowest_price:"140.600",trading_volume:"15363733"},{date:"150812",start_price:"140.000",end_price:"134.900",highest_price:"140.400",lowest_price:"133.900",trading_volume:"39624466"}]}}}function fixTxtHeight(){$(".news_sub_list a.txt").dotdotdot(),$(".info_item_list a.txt").dotdotdot()}var stock_first=!0;$(function(){fixTxtHeight(),loadStockData(),setInterval(loadStockData,5e3)});var Chart=function(e,t){this.$el=e,this.data=t};Chart.prototype.UTC=function(e){return Date.UTC(2e3+Number(e.substr(0,2)),Number(e.substring(2,4))-1,Number(e.substring(4)))},Chart.prototype.render=function(){for(var e=this.data,t=[],r=[],i=e.data.past,a=i.length,n=0;n<a;n++){var s=i[n],c=this.UTC(s.date);t.push([c,Number(s.start_price),Number(s.highest_price),Number(s.lowest_price),Number(s.end_price)]),r.push([c,Number(s.trading_volume)])}this.$el.highcharts("StockChart",{chart:{marginRight:30,plotBorderWidth:2},rangeSelector:{enabled:!1},scrollbar:{enabled:!1},dataGrouping:{enabled:!1},title:{text:""},credits:{enabled:!1},tooltip:{formatter:function(){var e=[];e.push("<em><b>"+Highcharts.dateFormat("%m-%d",this.x)+"</b></em>"),e.push("<br/>");var t=this.points[0].point;e.push("<span>开盘价："+Highcharts.numberFormat(t.open,1,".",",")+"</span><br/>"),e.push("<span>最高价："+Highcharts.numberFormat(t.high,1,".",",")+"</span><br/>"),e.push("<span>最低价："+Highcharts.numberFormat(t.low,1,".",",")+"</span><br/>"),e.push("<span>收盘价："+Highcharts.numberFormat(t.close,1,".",",")+"</span><br/>"),e.push("<br/>");var r=this.points[1].point;return e.push("<span>成交量："+Highcharts.numberFormat(r.y,0,".",",")+"</span>"),e.join("")}},yAxis:[{labels:{align:"right",x:30},title:{},height:"60%",lineWidth:2},{labels:{align:"right",x:30},title:{},top:"65%",height:"35%",offset:0,lineWidth:2}],xAxis:{type:"datetime",dateTimeLabelFormats:{day:"%m/%d",week:"%m/%d",month:"%Y-%m",year:"%Y"},startOnTick:!1,endOnTick:!1},navigator:{enabled:!1},exporting:{enabled:!1},series:[{type:"candlestick",name:"OHLC",data:t},{type:"column",name:"Volume",data:r,yAxis:1,color:"#0075bb"}]})};var Table=function(e,t){this.$el=e,this.data=t};Table.prototype.formatNum=function(e,t){var r=function(e,t){for(var r=e.toFixed(t)+"",i=/(-?\d+)(\d{3})/;i.test(r);)r=r.replace(i,"$1,$2");return r},i=function(e,t){if(/en-us/.test(location.href))var i=[{name:"B",value:1e9},{name:"M",value:1e6},{name:"",value:1}];else var i=[{name:"亿",value:1e8},{name:"万手",value:1e6},{name:"",value:1}];var a=[],n=i.length;return $.each(i,function(i,s){var c=e/s.value;if(c>1||i==n-1)return a.push(r(c,t)),a.push(s.name),!1}),a.join("")};return i(e,t)},Table.prototype.render=function(){var e=this.data.data,t={current_price:"price-amt",price_difference:{selector:"delta-amt",flt_type:9,filter:function(e){return Math.abs(e)}},difference_range:{selector:"delta-pct",flt_type:9,filter:function(e){return Math.abs(e)}},buy_price:"buy",highest_price:"high",yesterday_end:"y-close",year_highest:"high-52w",trading_volume:"volume",sell_price:"sell",lowest:"low",today_start:"open",year_lowest:"low-52w",trading_money:"amount",market_value:"worth",earning_ratio:"earn",unit:{selector:"unit",flt_type:0}};this.mapData(e.today,t);var r=this.$el.find(".price");e.today.price_difference<0?(r.find(".down").show(),r.find(".delta").addClass("delta_down")):(r.find(".up").show(),r.find(".delta").addClass("delta_up"));var i=e.past[e.past.length-1],a={date:{selector:"y-date",flt_type:9,filter:function(e){return["20",e.slice(0,2),".",e.slice(2,4),".",e.slice(4,6)].join("")}},end_price:"y-close",highest_price:"y-high",lowest_price:"y-low",trading_volume:"y-volume"};this.mapData(i,a)},Table.prototype.mapData=function(e,t){var r=this;$.each(t,function(t,i){var a;if("string"==typeof i)a=r.formatNum(e[t],2);else{var n=i.flt_type;0==n?a=e[t]:9==n&&(a=i.filter(e[t])),i=i.selector}r.$el.find("."+i).html(a)})};